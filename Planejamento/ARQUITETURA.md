# Arquitetura do ScanIA

## ๐๏ธ Visรฃo Geral da Arquitetura

O ScanIA foi projetado seguindo uma arquitetura de **microservices moderna** com princรญpios de **clean architecture** e **domain-driven design**.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CAMADA DE APRESENTAรรO                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  Web App (React/Next.js)  โ  Mobile App   โ  CLI Tool      โ
โ  - Interface de Chat       โ  - Notificaรงรตesโ  - Automaรงรฃo   โ
โ  - Dashboards             โ  - Relatรณrios  โ  - Scripts     โ
โ  - Relatรณrios             โ  - Consultas   โ  - CI/CD       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โ HTTPS/WSS
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     API GATEWAY (NGINX)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  - Rate Limiting          โ  - Load Balancing              โ
โ  - Authentication         โ  - SSL Termination             โ
โ  - Request Routing        โ  - Caching                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   CAMADA DE APLICAรรO                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              CORE API (FastAPI)                     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ  โข Auth Service      โข Chat Service                 โ   โ
โ  โ  โข User Management   โข Report Generator             โ   โ
โ  โ  โข Project Manager   โข Dashboard API                โ   โ
โ  โ  โข Notification Hub  โข WebSocket Manager            โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ            SCANNER ENGINE (Python)                  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ  โข Vulnerability Scanner  โข OWASP ZAP Integration   โ   โ
โ  โ  โข Port Scanner (Nmap)    โข Nuclei Engine           โ   โ
โ  โ  โข SSL/TLS Analyzer       โข Custom Modules          โ   โ
โ  โ  โข Web Crawler           โข CVE Database             โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ               AI ENGINE (Python)                    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ  โข NLP Processor         โข Threat Intelligence      โ   โ
โ  โ  โข Risk Assessment       โข Automated Remediation    โ   โ
โ  โ  โข Pattern Recognition   โข Predictive Analysis      โ   โ
โ  โ  โข Chat Bot Engine       โข ML Models                โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   CAMADA DE DOMรNIO                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ  โ   USER DOMAIN   โ  โ  SECURITY DOMAIN โ  โ REPORT DOMAINโ โ
โ  โโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโค โ
โ  โ โข User Entity   โ  โ โข Vulnerability โ  โ โข Report     โ โ
โ  โ โข Profile       โ  โ โข Scan Result   โ  โ โข Template   โ โ
โ  โ โข Permissions   โ  โ โข Threat        โ  โ โข Export     โ โ
โ  โ โข Subscription  โ  โ โข Risk Score    โ  โ โข Dashboard  โ โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 CAMADA DE INFRAESTRUTURA                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ  โ   DATABASES     โ  โ     CACHE       โ  โ   STORAGE   โ โ
โ  โโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโค โ
โ  โ โข PostgreSQL    โ  โ โข Redis         โ  โ โข MinIO     โ โ
โ  โ   - Users       โ  โ   - Sessions    โ  โ   - Reports โ โ
โ  โ   - Scans       โ  โ   - Cache       โ  โ   - Files   โ โ
โ  โ   - Reports     โ  โ   - Pub/Sub     โ  โ   - Backups โ โ
โ  โ   - Logs        โ  โ   - Queue       โ  โ   - Assets  โ โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ  โ  MONITORING     โ  โ   MESSAGING     โ  โ  EXTERNAL   โ โ
โ  โโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโโโโค โ
โ  โ โข Prometheus    โ  โ โข RabbitMQ      โ  โ โข CVE APIs  โ โ
โ  โ โข Grafana       โ  โ โข Celery        โ  โ โข OSINT     โ โ
โ  โ โข ELK Stack     โ  โ โข WebSockets    โ  โ โข Threat    โ โ
โ  โ โข Alertmanager  โ  โ โข Event Bus     โ  โ   Intel     โ โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ข Componentes Principais

### 1. Frontend (React/Next.js)

```typescript
src/
โโโ components/
โ   โโโ chat/
โ   โ   โโโ ChatInterface.tsx
โ   โ   โโโ MessageBubble.tsx
โ   โ   โโโ ChatInput.tsx
โ   โโโ dashboard/
โ   โ   โโโ SecurityDashboard.tsx
โ   โ   โโโ VulnerabilityChart.tsx
โ   โ   โโโ ThreatMap.tsx
โ   โโโ scanner/
โ   โ   โโโ ScannerForm.tsx
โ   โ   โโโ ScanProgress.tsx
โ   โ   โโโ ScanResults.tsx
โ   โโโ reports/
โ     โโโ ReportViewer.tsx
โ     โโโ ReportGenerator.tsx
โ     โโโ PDFExporter.tsx
โโโ pages/
โ   โโโ dashboard/
โ   โโโ scanner/
โ   โโโ reports/
โ   โโโ chat/
โโโ hooks/
โ   โโโ useWebSocket.ts
โ   โโโ useScanner.ts
โ   โโโ useAuth.ts
โโโ services/
โ   โโโ api.ts
โ   โโโ websocket.ts
โ   โโโ scanner.ts
โโโ types/
    โโโ api.ts
    โโโ scanner.ts
    โโโ user.ts
```

### 2. Backend Core (FastAPI)

```python
app/
โโโ api/
โ   โโโ v1/
โ   โ   โโโ auth.py
โ   โ   โโโ scanner.py
โ   โ   โโโ reports.py
โ   โ   โโโ chat.py
โ   โ   โโโ dashboard.py
โ   โโโ dependencies.py
โโโ core/
โ   โโโ config.py
โ   โโโ security.py
โ   โโโ database.py
โ   โโโ websocket.py
โโโ models/
โ   โโโ user.py
โ   โโโ scan.py
โ   โโโ vulnerability.py
โ   โโโ report.py
โโโ services/
โ   โโโ auth_service.py
โ   โโโ scanner_service.py
โ   โโโ report_service.py
โ   โโโ chat_service.py
โ   โโโ ai_service.py
โโโ schemas/
โ   โโโ user.py
โ   โโโ scan.py
โ   โโโ report.py
โโโ utils/
    โโโ security.py
    โโโ validators.py
    โโโ helpers.py
```

### 3. Scanner Engine

```python
scanner/
โโโ engines/
โ   โโโ owasp_zap.py
โ   โโโ nuclei.py
โ   โโโ nmap.py
โ   โโโ ssl_analyzer.py
โ   โโโ web_crawler.py
โโโ analyzers/
โ   โโโ vulnerability_analyzer.py
โ   โโโ risk_assessor.py
โ   โโโ compliance_checker.py
โ   โโโ threat_correlator.py
โโโ databases/
โ   โโโ cve_db.py
โ   โโโ threat_intel.py
โ   โโโ signatures.py
โโโ reporting/
    โโโ pdf_generator.py
    โโโ html_generator.py
    โโโ json_exporter.py
```

## ๐ Seguranรงa da Arquitetura

### Camadas de Seguranรงa

1. **Rede**
   - WAF (Web Application Firewall)
   - DDoS Protection
   - SSL/TLS Encryption
   - VPN para acesso interno

2. **Aplicaรงรฃo**
   - JWT Authentication
   - OAuth2/OIDC Integration
   - RBAC (Role-Based Access Control)
   - Input Validation & Sanitization

3. **Dados**
   - Encryption at Rest
   - Encryption in Transit
   - Database Access Controls
   - Audit Logging

4. **Infraestrutura**
   - Container Security
   - Secrets Management
   - Network Segmentation
   - Monitoring & Alerting

### Fluxo de Autenticaรงรฃo

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant G as API Gateway
    participant A as Auth Service
    participant D as Database
    
    U->>F: Login Request
    F->>G: POST /auth/login
    G->>A: Validate Credentials
    A->>D: Query User
    D-->>A: User Data
    A-->>G: JWT Token
    G-->>F: Auth Response
    F-->>U: Redirect to Dashboard
```

## ๐ Banco de Dados

### Modelo de Dados Principal

```sql
-- Usuรกrios e Autenticaรงรฃo
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Projetos de Seguranรงa
CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    targets JSONB NOT NULL,
    status VARCHAR(50) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT NOW()
);

-- Scans de Vulnerabilidade
CREATE TABLE scans (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID REFERENCES projects(id),
    target_url VARCHAR(500) NOT NULL,
    scan_type VARCHAR(100) NOT NULL,
    status VARCHAR(50) DEFAULT 'pending',
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    results JSONB,
    metadata JSONB
);

-- Vulnerabilidades Encontradas
CREATE TABLE vulnerabilities (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    scan_id UUID REFERENCES scans(id),
    cve_id VARCHAR(50),
    severity VARCHAR(20) NOT NULL,
    title VARCHAR(500) NOT NULL,
    description TEXT,
    solution TEXT,
    cvss_score DECIMAL(3,1),
    affected_url VARCHAR(500),
    evidence JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Relatรณrios Gerados
CREATE TABLE reports (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    scan_id UUID REFERENCES scans(id),
    type VARCHAR(50) NOT NULL,
    format VARCHAR(20) NOT NULL,
    file_path VARCHAR(500),
    status VARCHAR(50) DEFAULT 'generating',
    generated_at TIMESTAMP,
    expires_at TIMESTAMP
);

-- Chat e Conversas
CREATE TABLE conversations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    title VARCHAR(255),
    context JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID REFERENCES conversations(id),
    role VARCHAR(20) NOT NULL, -- 'user' or 'assistant'
    content TEXT NOT NULL,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### Cache Strategy (Redis)

```python
# Estrutura de Cache
{
    "user_sessions:{user_id}": {
        "session_data": "...",
        "expiry": 3600
    },
    "scan_results:{scan_id}": {
        "vulnerabilities": [...],
        "metadata": {...},
        "expiry": 7200
    },
    "dashboard_data:{user_id}": {
        "recent_scans": [...],
        "stats": {...},
        "expiry": 300
    }
}
```

## ๐ Deploy e Escalabilidade

### Container Architecture

```yaml
version: '3.8'
services:
  nginx:
    image: nginx:alpine
    ports:      ["80:80", "443:443"]
    depends_on: [frontend, api]
    
  frontend:
    build: ./frontend
    ports: ["3000:3000"]
    
  api:
    build: ./backend
    ports: ["8000:8000"]
    depends_on: [postgres, redis]
    
  scanner:
    build: ./scanner
    depends_on: [api, postgres]
    
  postgres:
    image: postgres:15
    volumes: ["postgres_data:/var/lib/postgresql/data"]
    
  redis:
    image: redis:alpine
    volumes: ["redis_data:/data"]
    
  monitoring:
    image: prom/prometheus
    ports: ["9090:9090"]
```

### Horizontally Scalable Components

1. **API Servers**: Load balanced com NGINX
2. **Scanner Workers**: Queue-based com Celery
3. **AI Processing**: GPU workers separados
4. **Static Assets**: CDN (CloudFlare/AWS)

## ๐ Performance e Monitoramento

### Mรฉtricas Chave
- **Response Time**: < 200ms para API calls
- **Scan Duration**: < 5min para scans bรกsicos
- **Throughput**: 100+ concurrent scans
- **Availability**: 99.9% uptime

### Observabilidade
- **Logs**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **Mรฉtricas**: Prometheus + Grafana
- **Traces**: Jaeger para distributed tracing
- **Alertas**: AlertManager + PagerDuty

---

Esta arquitetura permite escalabilidade horizontal, alta disponibilidade e extensibilidade para futuras funcionalidades de cyberseguranรงa.